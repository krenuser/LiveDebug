<?php

class LD {
    private $is_translation_loaded = false;
    private $translation_array = array();
    
    private function loadTranslation(){
        /*$this->translation_array = array(
            'mnuFile'           => 'Файл',
            'mnuFileNew'            => 'Новый',
            'mnuFileLoad'           => 'Загрузить',
            'mnuFileSave'           => 'Сохранить',
            
            'mnuTemplate'       => 'Шаблоны',
            'mnuTemplateAdd'        => 'Добавить',
            
            'mnuRunMode'        => 'Режим запуска',
            'mnuRunModeEval'        => 'eval()',
            'mnuRunModeFile'        => 'Файловый режим',
            
            'mnuRun'            => 'Выполнить код',
            
            'txtAppTitle'       => 'LiveDebug 4.0',
            'txtNavbarTitle'    => 'LiveDebug',
            'txtToggleMenu'     => 'Скрыть/развернуть меню',
            'txtFileList'       => 'Список файлов',
            'txtClose'          => 'Закрыть',
            'txtSave'           => 'Сохранить',
            'txtLoad'           => 'Открыть',
        );*/
        $this->translation_array = parse_ini_file('lib/lang.ru.ini');
        
        $this->is_translation_loaded = true;
    }
    
    public function getTranslatedCaption($id) {
        if(!$this->is_translation_loaded) {
            $this->loadTranslation();
        }
        return $this->translation_array[$id] ? $this->translation_array[$id] : $id;
    }
    
    public function processRequest($request) {
        switch($request['act']) {
            case 'run':
                if(
                    (defined('RUN_MODE') && RUN_MODE == 'eval') 
                    || (defined('RUN_MODE') && RUN_MODE == 'user' && $request['mode'] == 'eval')
                ) {
                    if(substr($request['code'], 0, 5) != '<?php') {
                        $request['code'] = '?>'.$request['code'];
                    }
                    eval(preg_replace('/^<\\?php/i', '', $request['code']));
                    die;
                }
                if(
                    (defined('RUN_MODE') && RUN_MODE == 'file') 
                    || (defined('RUN_MODE') && RUN_MODE == 'user' && $request['mode'] == 'file')
                ) {
                    $runid = $request['runid'];
                    $filename = date('Y-m-d-h-i-s').'_'.$runid.'.php';
                    file_put_contents(TMP_RUN_PATH.$filename, '<?php '.$request['code']);
                    header("Location: ".TMP_RUN_URL.$filename, true);
                    die;
                }
            break;
            
            default:
                return;
            break;
        }
        die();
    }
}